## ğŸš€ é‡ç—‡é¢„æµ‹æ¨¡å‹ï¼š14æ­¥æ ‡å‡†åŒ–ç ”ç©¶æµ (MIMIC -> eICU)

### ç¬¬ä¸€é˜¶æ®µï¼šæ•°æ®å·¥ç¨‹ä¸åŸºçŸ³æ„å»º (MIMIC)

æœ¬é˜¶æ®µçš„æ ¸å¿ƒæ˜¯å°† SQL åŸå§‹æ•°æ®è½¬åŒ–ä¸ºå¯è¿›å…¥æ¨¡å‹çš„ç»“æ„åŒ–å¼ é‡ï¼Œå¹¶å»ºç«‹ç‰¹å¾å…ƒæ•°æ®å­—å…¸ã€‚

* **`01_mimic_sql_extraction.sql`**ï¼šæå– MIMIC å€™é€‰ç‰¹å¾ä¸ç»“å±€ï¼Œè¾“å‡º `mimic_raw_data.csv`ã€‚
* **`02_mimic_cleaning.py`**ï¼šæ‰§è¡Œç¼ºå¤±å€¼å®¡è®¡ã€å¼‚å¸¸å€¼å¤„ç†åŠè¡ç”Ÿå˜é‡è®¡ç®—ï¼Œå¹¶**åŒæ­¥åˆå§‹åŒ–** `feature_dictionary.json`ã€‚
* **`03_mimic_standardization.py`**ï¼š
* ä¿å­˜ `mimic_raw_scale.csv` (ç‰©ç†å•ä½ï¼Œç”¨äº Table 1-4)ã€‚
* ä¿å­˜ `mimic_processed.csv` (æ•°å€¼å½’ä¸€åŒ–ç‰ˆ)ã€‚
* **æŒä¹…åŒ–èµ„äº§**ï¼šä¿å­˜ `mimic_scaler.joblib` ä¾›å¤–éƒ¨éªŒè¯ä½¿ç”¨ã€‚



### ç¬¬äºŒé˜¶æ®µï¼šç»Ÿè®¡å®¡è®¡ä¸åŸºçº¿åˆ†æ

åœ¨å»ºæ¨¡å‰ï¼Œç¡®ä¿æ•°æ®ç¬¦åˆä¸´åºŠåˆ†å¸ƒè§„å¾‹ã€‚

* **`04_mimic_stat_audit.py`**ï¼šæ‰§è¡Œå•å› ç´ åˆ†æã€è‚¾åŠŸèƒ½äºšç»„å¯¹æ¯”åŠä¸‰ç»“å±€å‘ç”Ÿç‡å®¡è®¡ï¼ˆäº§å‡º Table 2 & 3ï¼‰ã€‚

### ç¬¬ä¸‰é˜¶æ®µï¼šç‰¹å¾ç²¾ç‚¼ä¸æ¨¡å‹ç«èµ› (Modeling)

* **`05_feature_selection_lasso.py`**ï¼šåŸºäº 1-SE å‡†åˆ™è¿›è¡Œ LASSO é™ç»´ã€‚
* **å…³é”®äº§å‡º**ï¼š`selected_features.json`ï¼ˆä»…å«å…¥æ¨¡ç‰¹å¾åŠå…¶åœ¨ eICU ä¸­çš„æ˜ å°„æŒ‡ä»¤ï¼‰ã€‚


* **`06_model_training_main.py`**ï¼šé’ˆå¯¹ä¸‰ç§ç»“å±€ï¼ˆPOF, Mortality, Compositeï¼‰è®­ç»ƒ 5 å¤§æ¨¡å‹ï¼Œå¹¶å°†èµ„äº§åˆ†æ–‡ä»¶å¤¹å­˜å…¥ `artifacts/models/`ã€‚

### ç¬¬å››é˜¶æ®µï¼šæˆªæ–­å€¼è®¡ç®—ä¸æ•ˆèƒ½å®¡è®¡ (Clinical Cutoff)

å°†æ¦‚ç‡æ¨¡å‹è½¬åŒ–ä¸ºä¸´åºŠè¯Šæ–­å·¥å…·ã€‚

* **`07_optimal_cutoff_analysis.py`**ï¼š
* **åŠŸèƒ½**ï¼šåŸºäºå¼€å‘é›†å¯»æ‰¾ Youden Index æœ€å¤§ç‚¹ï¼Œç¡®å®šå„æ¨¡å‹çš„**æœ€ä½³æˆªæ–­å€¼**ã€‚
* **èµ„äº§**ï¼šå°† Cutoff å€¼å†™å…¥å„å­ç›®å½•ä¸‹çš„ `thresholds.json`ã€‚
* **å®¡è®¡**ï¼šè¾“å‡ºå†…éƒ¨éªŒè¯çš„æ•æ„Ÿåº¦ã€ç‰¹å¼‚åº¦ã€NPV/PPV åŠ F1-scoreã€‚



### ç¬¬äº”é˜¶æ®µï¼šåç½®å¤–éƒ¨éªŒè¯ (eICU Validation)

åŸºäºâ€œç‰¹å¾æ¸…å•â€å»å¤–éƒ¨åº“ææ•°ï¼Œå®ç°ä¸¥æ ¼çš„å¤–éƒ¨å¯¹é½ã€‚

* **`08_eicu_sql_extraction.sql`**ï¼š**[å…ƒæ•°æ®é©±åŠ¨]** ä¾æ® `selected_features.json` æå– eICU å¯¹åº”ç‰¹å¾ã€‚
* **`09_eicu_alignment_cleaning.py`**ï¼šæ ¹æ®å­—å…¸æ‰§è¡Œå•ä½æ¢ç®—ï¼ˆå¦‚ Âµmol/L -> mg/dLï¼‰ï¼Œäº§å‡º `eicu_processed.csv`ã€‚
* **`10_cross_cohort_audit.py`**ï¼šæ‰§è¡Œ MIMIC vs eICU çš„è·¨åº“åŸºçº¿å¯¹æ¯”ï¼ˆäº§å‡º Table 1ï¼‰ã€‚
* **`11_external_validation_perf.py`**ï¼š
* **æ•ˆèƒ½è¯„ä¼°**ï¼šè®¡ç®— eICU ä¸Šçš„å¤–éƒ¨ AUC/AUPRCã€‚
* **è¿ç§»å®¡è®¡**ï¼šç›´æ¥åº”ç”¨ MIMIC çš„é˜ˆå€¼ï¼Œè¯„ä¼°æ¨¡å‹åœ¨å¤–éƒ¨ç¯å¢ƒçš„ä¸´åºŠå¯é æ€§ã€‚



### ç¬¬å…­é˜¶æ®µï¼šä¸´åºŠè§£é‡Šä¸è½¬åŒ–å†³ç­– (Translation)

* **`12_model_interpretation_shap.py`**ï¼šåˆ©ç”¨ SHAP å€¼è§£é‡Šæ¨¡å‹å†³ç­–çš„ä¸´åºŠé€æ˜åº¦ã€‚
* **`13_clinical_calibration_dca.py`**ï¼šç»˜åˆ¶æ ¡å‡†æ›²çº¿ï¼ˆå¯é æ€§ï¼‰ä¸å†³ç­–æ›²çº¿ï¼ˆä¸´åºŠè·ç›Šåº¦ï¼‰ã€‚
* **`14_nomogram_odds_ratio.py`**ï¼šç”Ÿæˆè¯ºè«å›¾å¹¶è®¡ç®—å˜é‡çš„æ¯”å€¼æ¯” (OR)ï¼Œå®Œæˆå­¦æœ¯æŠ¥å‘Šã€‚

---

### ğŸ“‚ é¡¹ç›®ç›®å½•æ ‘

```text
project_root/
â”‚
â”œâ”€â”€ data/
â”‚   â”œâ”€â”€ raw/                           # åŸå§‹æ•°æ®å¿«ç…§ (Immutable)
â”‚   â”‚   â”œâ”€â”€ mimic_raw_data.csv         # 01 æ­¥äº§å‡ºï¼šå«æ‰€æœ‰å€™é€‰ç‰¹å¾
â”‚   â”‚   â””â”€â”€ eicu_raw_data.csv          # 08 æ­¥äº§å‡ºï¼šä»…å«é€‰å®šç‰¹å¾çš„é•¿è¡¨æˆ–å®½è¡¨
â”‚   â”œâ”€â”€ cleaned/                       # MIMIC å¼€å‘é›†ä¸­é—´äº§ç‰©
â”‚   â”‚   â”œâ”€â”€ mimic_raw_scale.csv        # 03 æ­¥äº§å‡ºï¼šæ¸…æ´—åã€æœªæ ‡å‡†åŒ–çš„ç‰©ç†å€¼
â”‚   â”‚   â””â”€â”€ mimic_processed.csv        # 03 æ­¥äº§å‡ºï¼šæ ‡å‡†åŒ–åçš„å»ºæ¨¡å¼ é‡
â”‚   â””â”€â”€ external/                      # eICU éªŒè¯é›†ä¸­é—´äº§ç‰©
â”‚       â”œâ”€â”€ eicu_aligned.csv           # 09 æ­¥äº§å‡ºï¼šç‰©ç†å•ä½å¯¹é½åçš„æ•°æ®
â”‚       â””â”€â”€ eicu_processed.csv         # 09 æ­¥äº§å‡ºï¼šåº”ç”¨ MIMIC å°ºåº¦å˜æ¢åçš„æ•°æ®
â”‚
â”œâ”€â”€ scripts/                           # 14 æ­¥æ ‡å‡†åŒ–å·¥ä½œæµ (Python/SQL)
â”‚   â”œâ”€â”€ 01_sql/                        # æ•°æ®åº“æå–å±‚
â”‚   â”‚   â”œâ”€â”€ 01_mimic_extraction.sql
â”‚   â”‚   â””â”€â”€ 08_eicu_extraction.sql
â”‚   â”œâ”€â”€ 02_preprocess/                 # ç‰¹å¾å·¥ç¨‹å±‚
â”‚   â”‚   â”œâ”€â”€ 02_mimic_cleaning.py       # æ ¸å¿ƒï¼šå¤„ç†ç¼ºå¤±å€¼ã€å¼‚å¸¸å€¼ã€ç”Ÿæˆå­—å…¸
â”‚   â”‚   â”œâ”€â”€ 03_mimic_standardization.py
â”‚   â”‚   â””â”€â”€ 09_eicu_alignment_cleaning.py
â”‚   â”œâ”€â”€ 03_modeling/                   # æ¨¡å‹ç«èµ›å±‚
â”‚   â”‚   â”œâ”€â”€ 05_feature_selection_lasso.py
â”‚   â”‚   â”œâ”€â”€ 06_model_training_main.py  # è®­ç»ƒ LR, XGB, LGBM, RF, MLP
â”‚   â”‚   â””â”€â”€ 07_optimal_cutoff_analysis.py
â”‚   â””â”€â”€ 04_audit_eval/                 # éªŒè¯ä¸ç»Ÿè®¡å±‚
â”‚       â”œâ”€â”€ 04_mimic_stat_audit.py     # å†…éƒ¨ç»Ÿè®¡æè¿°
â”‚       â”œâ”€â”€ 10_cross_cohort_audit.py   # Table 1 è·¨åº“åŸºçº¿å¯¹æ¯”
â”‚       â”œâ”€â”€ 11_external_validation_perf.py
â”‚       â”œâ”€â”€ 12_model_interpretation_shap.py
â”‚       â”œâ”€â”€ 13_clinical_calibration_dca.py
â”‚       â””â”€â”€ 14_nomogram_odds_ratio.py
â”‚
â”œâ”€â”€ artifacts/                         # é¡¹ç›®çš„å¤§è„‘ï¼šè·¨è„šæœ¬è°ƒç”¨çš„èµ„äº§
â”‚   â”œâ”€â”€ models/                        # è®­ç»ƒå¥½çš„æ¨¡å‹åºåˆ—åŒ–æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ pof/                       # best_model_xgb.joblib, thresholds.json
â”‚   â”‚   â”œâ”€â”€ mortality/                 # best_model_lr.joblib, thresholds.json
â”‚   â”‚   â””â”€â”€ composite/
â”‚   â”œâ”€â”€ scalers/                       # æ ‡å‡†åŒ–å‚æ•°
â”‚   â”‚   â””â”€â”€ mimic_scaler.joblib        # å­˜æ”¾ Mean/Std æˆ– Min/Max
â”‚   â””â”€â”€ features/                      # ç‰¹å¾ç®¡ç†é…ç½®
â”‚       â”œâ”€â”€ feature_dictionary.json    # å…¨é›†ï¼šå˜é‡å®šä¹‰ã€å•ä½ã€è·¨åº“æ˜ å°„å
â”‚       â””â”€â”€ selected_features.json     # å­é›†ï¼šLASSO é€‰å‡ºçš„ç‰¹å¾æå–æŒ‡ä»¤
â”‚
â”œâ”€â”€ results/                           # äº§å‡ºå±‚ (ç›´æ¥ç”¨äºæ’°å†™è®ºæ–‡)
â”‚   â”œâ”€â”€ tables/
â”‚   â”‚   â”œâ”€â”€ table1_baseline.csv        # è·¨åº“å¯¹æ¯”è¡¨
â”‚   â”‚   â”œâ”€â”€ table2_stats_internal.csv  # å†…éƒ¨äºšç»„åˆ†æè¡¨
â”‚   â”‚   â”œâ”€â”€ model_performance_metrics.csv # å„æ¨¡å‹ AUC, AUPRC, Sen, Spe
â”‚   â”‚   â””â”€â”€ odds_ratios.csv            # é€»è¾‘å›å½’ OR å€¼åˆ—è¡¨
â”‚   â””â”€â”€ figures/                       # é«˜æ¸…å›¾ (png/pdf/svg)
â”‚       â”œâ”€â”€ pof/                       # æ–‡ä»¶å¤¹ï¼šAUC_curve, Calibration_plot, DCA, SHAP_summary
â”‚       â”œâ”€â”€ mortality/
â”‚       â””â”€â”€ composite/
â”‚
â”œâ”€â”€ logs/                              # è¿è¡Œå®¡è®¡
â”‚   â””â”€â”€ pipeline_run_20240520.log      # è®°å½•æ ·æœ¬æµè½¬ã€æ‰§è¡Œè€—æ—¶ã€è­¦å‘Šä¿¡æ¯
â”œâ”€â”€ requirements.txt                   # ç¯å¢ƒä¾èµ– (å¦‚: scikit-learn==1.0.2, xgboost)
â””â”€â”€ README.md                          # é¡¹ç›®ç®€è¿°ä¸è¿è¡ŒæŒ‡å—

```

---

### ğŸ› ï¸ æµç¨‹æ ¸å¿ƒé€»è¾‘ä¿éšœ

1. **ç‰¹å¾å¯¹é½ä¸­æ¢**ï¼šé€šè¿‡ `feature_dictionary.json` è§£å†³äº†ä¸åŒæ•°æ®åº“é—´â€œåŒåä¸åŒä¹‰â€æˆ–â€œåŒä¹‰ä¸åŒåâ€çš„é—®é¢˜ï¼Œæ˜¯ç¡®ä¿å¤–éƒ¨éªŒè¯æˆåŠŸçš„å…³é”®ã€‚
2. **èµ„äº§åˆ†å±‚ç®¡ç†**ï¼šå°† `thresholds.json` ä¸æ¨¡å‹æ–‡ä»¶ç»‘å®šï¼Œç¡®ä¿ä»æ¦‚ç‡è¾“å‡ºåˆ°ä¸´åºŠå†³ç­–çš„æ¯ä¸€æ­¥éƒ½æœ‰æ®å¯æŸ¥ã€‚
3. **ç»“æœéš”ç¦»æ€§**ï¼š`results/figures/` çš„å­æ–‡ä»¶å¤¹è®¾è®¡ï¼Œè®©æ‚¨åœ¨å¤„ç†ä¸‰ç§ä¸åŒä¸´åºŠç»ˆç‚¹æ—¶ï¼Œå›¾è¡¨è¾“å‡ºäº•ç„¶æœ‰åºï¼Œç»ä¸æ··æ·†ã€‚

---
