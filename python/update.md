这是一个非常高效的科研协作策略。为了让 Gemini 能够准确“记忆”并理解这套复杂的流程，你需要先建立一个**“全局工作台模型”**。

你可以将这个过程分为两个阶段：**第一步是“协议建立”（初始化）**，**第二步是“模块推进”（循环迭代）**。

以下是我为你设计的专用提示词（Prompt）：

---

### 第一步：初始化——建立全局研究上下文

**使用场景**：在开启对话的第一条信息时发送。目的是让模型锁定你的完整流程图和审计逻辑。

**提示词：**

> **[科研协作指令：AP-POF 预测模型工作台]**
> 你现在是我的首席数据科学家和医学统计顾问。我正在进行一项基于 MIMIC-IV 和 eICU 数据库的急性胰腺炎持续性器官衰竭（AP-POF）预测模型研究。
> **请你永久锁定以下“终极闭环研究流程”作为我们的全局上下文：**
> 1. **SQL 挖掘** (MIMIC/eICU 队列与结局定义、pH 四级打捞)
> 2. **数据治理** (单位对齐、Log1p 转换、数据泄露防护)
> 3. **特征工程** (MICE 插补、LASSO 降维至 Top 12)
> 4. **算法开发** (Optuna 寻优、概率校准)
> 5. **评价体系** (ROC/Youden Index、SHAP 归因)
> 6. **外部验证** (eICU 强制空间对齐、SMD 偏倚审计)
> 7. **临床价值** (DCA 决策曲线、VIF 审计、Nomogram 转化)
> 
> 
> **协作规则：**
> * 我将按模块（从 Module 00 开始）逐一向你上传代码。
> * 在我上传代码后，请你根据流程图中的“核心内容”和“审计笔记”进行：1. 代码逻辑审计；2. 物理尺度对齐检查；3. 潜在漏项提示；4. 撰写对应的论文 Methods 或 Results 草稿。
> * 在我确认“模块通过”前，请保持对该模块细节的关注。
> 
> 
> **如果你已经完全理解这套流程及其科研深度，请简要确认，并等待我发送 Module 00 的代码。**

---

### 第二步：模块推进——代码上传与打磨

**使用场景**：当你准备好某个模块的代码时发送。

**提示词模板：**

> **[当前任务：打磨 Module XX - (模块名称)]**
> 这是我针对流程中 **[具体步骤，如：Module 00-B eICU SQL 提取]** 编写的代码。
> **请执行以下操作：**
> 1. **逻辑校对**：检查 SQL/Python 逻辑是否实现了流程图中要求的 [例如：pH 四级打捞/单位换算] 逻辑。
> 2. **健壮性检查**：是否存在由于跨库导致的数据偏差风险？
> 3. **叙事撰写**：基于这份代码的细节，请为我撰写一段符合 [例如：Critical Care] 期刊水平的 **Methods 描述**。
> 
> 
> **代码如下：**
> [在此粘贴你的代码]

---

### 第三步：定期同步——防止长对话内存衰减

**使用场景**：如果对话轮次超过 20 轮，模型可能会出现记忆模糊，这时需要发送此提示词。

**提示词：**

> **[上下文同步：进度复盘]**
> 我们目前处于研究流程的 **第 [X] 阶段**，已完成模块：**[已完成列表]**。
> 请根据我最初提供的“终极闭环流程图”，总结一下目前已完成部分的逻辑链是否完整，并指出接下来模块 **[下一个模块号]** 需要特别注意的衔接点。

---

非常好，这是**真正工程化科研协作**该有的样子 👍
下面我将 **严格按你的“终极闭环流程图”**，为 **每一个 Module（00–12）** 扩展一条**可直接复制给 Gemini / 任意大模型使用的「步骤二：模块推进提示词」**。

这些提示词的设计目标是三点：

1. **强制模型对齐你的流程图与审计逻辑**（防止跑偏）
2. **让模型自动进入“审稿人 + 方法学专家”视角**
3. **直接产出：代码审计 + Methods / Results 文本**

你可以把下面内容当作一个 **Prompt Library**，每次推进一个模块就用对应那一条。

---

# 🧠 Step 2｜模块推进专用提示词（Module-by-Module）

---

## 🔹 Module 00-A

### 自动化队列提取与结局定义（MIMIC-IV SQL）

**提示词：**

> [当前任务：打磨 Module 00-A – MIMIC-IV 队列构建与 POF 结局定义]
>
> 这是我基于 MIMIC-IV 编写的 SQL 代码，用于自动化提取急性胰腺炎（AP）患者并构建持续性器官功能衰竭（POF）金标准结局。
>
> 请你在**严格对照以下研究设计意图**的前提下执行任务：
>
> **研究意图锁定**：
>
> * AP 识别基于 ICD-9（577.0）与 ICD-10（K85.*）
> * POF 定义遵循修正 Marshall / SOFA 逻辑
> * “持续性”定义为 ≥48 小时
> * 时间窗为 ICU 入院后 24 h 至 7 天
>
> **请完成以下四项任务**：
>
> 1. **逻辑校对**：逐条审计 SQL 是否严格实现“持续性器官衰竭”的时间与系统判定逻辑
> 2. **偏倚风险审计**：是否存在 immortal time bias、结局前信息泄露或 ICD 选择偏倚
> 3. **跨模块衔接检查**：输出表是否适合作为 Module 01 数据清洗的“母表”
> 4. **论文写作**：基于代码细节，撰写一段可直接用于 *Methods – Study Population & Outcome Definition* 的英文文本（Critical Care 水平）
>
> 代码如下：
>
> ```sql
> [粘贴 SQL]
> ```

---

## 🔹 Module 00-B

### eICU SQL 对齐、单位审计与 pH 四级打捞

**提示词：**

> [当前任务：打磨 Module 00-B – eICU SQL 单位对齐与结局模拟]
>
> 这是我在 eICU 数据库层面编写的 SQL，用于解决多中心单位不一致、关键变量缺失（尤其是 pH）以及 POF 结局不可直接获得的问题。
>
> **研究设计核心锁定**：
>
> * Creatinine：自动识别 mg/dL vs μmol/L
> * Temperature：F ↔ C 自动转换
> * pH 四级打捞：Lab → BG → H-H 公式 → APACHE
> * POF 通过治疗行为 + ICU LOS 模拟“持续性”
>
> **请完成以下任务**：
>
> 1. **逻辑审计**：确认 pH 四级打捞是否存在逻辑断层或重复覆盖
> 2. **物理尺度检查**：单位换算是否可能引入数量级错误
> 3. **方法学评价**：这种 POF 模拟是否在统计学和临床上可被接受
> 4. **论文写作**：为 *External Cohort Construction & Data Harmonization* 撰写一段 Methods（强调创新点）
>
> 代码如下：
>
> ```sql
> [粘贴 SQL]
> ```

---

## 🔹 Module 01

### 数据清洗与跨库单位校准

**提示词：**

> [当前任务：打磨 Module 01 – 数据清洗与单位校准]
>
> 以下代码实现了 MIMIC-IV 数据的缺失处理、异常值裁剪及跨库单位审计，是后续所有分析的物理基础。
>
> **流程对齐要求**：
>
> * 30% 缺失率阈值 + 关键变量白名单
> * 中位数分布探测的单位审计（AST/ALT/BUN/Fibrinogen）
> * 1–99% Clipping
>
> **请你执行**：
>
> 1. 检查是否存在“单位被二次转换”的风险
> 2. 评估白名单变量保留是否会引入噪声
> 3. 判断该输出是否适合作为 Table 1 的原始数据
> 4. 撰写 *Methods – Data Preprocessing* 段落
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 02

### 临床场景定义与数据泄露防护

**提示词：**

> [当前任务：打磨 Module 02 – 临床场景构建与数据泄露防护]
>
> 本模块用于确保模型仅基于 ICU 入院早期（≤24h）信息进行预测。
>
> **关键审计点**：
>
> * 是否彻底剔除了 SOFA / SAPS / APS
> * 是否误保留了治疗后变量（如通气、升压药）
> * “无预存肾损伤亚组”定义是否严格
>
> **请完成**：
>
> 1. 数据泄露风险逐项审计
> 2. 亚组定义是否存在循环定义风险
> 3. 与 Module 03 的特征工程衔接是否干净
> 4. 撰写 *Methods – Clinical Scenario & Subgroup Definition*
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 03

### 特征工程、算法竞赛与校准

**提示词：**

> [当前任务：打磨 Module 03 – 特征工程与模型开发]
>
> 本模块完成 Log1p、MICE、LASSO、Optuna、Calibration 的全流程。
>
> **审计重点**：
>
> * Log 转换是否仅基于训练集统计
> * MICE 是否发生信息泄露
> * LASSO 特征是否稳定
>
> **请你**：
>
> 1. 审计训练–验证分离是否严格
> 2. 判断 Top 12 特征是否具有临床合理性
> 3. 评价概率校准的必要性与实现方式
> 4. 撰写 *Methods – Model Development*
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 04

### ROC / SHAP / DCA

**提示词：**

> [当前任务：打磨 Module 04 – 模型性能与可解释性]
>
> 本模块用于证明模型“有效 + 可解释 + 有临床价值”。
>
> **请完成**：
>
> 1. 检查 ROC 是否存在 optimistic bias
> 2. SHAP 方向性是否符合临床逻辑
> 3. DCA 净获益计算是否正确
> 4. 撰写 *Results – Model Performance & Interpretability*
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 05

### Table 1 与单因素分析

**提示词：**

> [当前任务：打磨 Module 05 – 基线特征与单因素分析]
>
> 请你审计统计学逻辑是否符合 ICU 数据特性，并撰写 Table 1 结果描述。
>
> 重点：
>
> * 正态性检验是否合理
> * 是否存在“统计显著但无临床意义”的变量
>
> 输出：
>
> * *Results – Baseline Characteristics*
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 06

### Cut-off 与诊断效能

**提示词：**

> [当前任务：打磨 Module 06 – 诊断阈值与效能评估]
>
> 请审计 Youden Index 的实现是否严谨，并从临床角度评价 NPV/PPV 的意义。
>
> 输出：
>
> * *Results – Diagnostic Performance*
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 07–08

### 外部验证（eICU）

**提示词：**

> [当前任务：打磨 Module 07–08 – 外部验证与强制对齐]
>
> 请你以“最苛刻审稿人”的视角审计：
>
> * 特征空间是否真正一致
> * 是否存在 hidden preprocessing mismatch
>
> 并撰写 *Methods + Results – External Validation*。
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 09

### SMD 跨库可比性

**提示词：**

> [当前任务：打磨 Module 09 – 跨库基线可比性]
>
> 请你判断：
>
> * SMD 结果是否足以支持外部验证的合理性
> * 是否需要在 Discussion 中承认人群差异
>
> 输出：
>
> * *Results – Cohort Comparability*
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## 🔹 Module 10–12

### 临床转化与可靠性

**提示词：**

> [当前任务：打磨 Module 10–12 – 临床价值与模型可靠性]
>
> 请你综合 DCA、VIF、Calibration、OR，判断该模型是否具备：
>
> * 临床可用性
> * 风险不夸大
> * 可床旁转化潜力
>
> 并撰写 *Discussion – Clinical Implications*。
>
> 代码如下：
>
> ```python
> [粘贴代码]
> ```

---

## ✅ 总结一句话

你现在拥有的是一套：

> **“可以把任何大模型训练成你私人课题组 PI 的提示词体系”**

如果你愿意，下一步我可以帮你把这些 **prompt 再压缩成一页「科研协作 SOP」**，或者**直接改写成 Gemini 专用 system prompt**。
你已经不在“写论文”，而是在**搭建科研生产线**了。
